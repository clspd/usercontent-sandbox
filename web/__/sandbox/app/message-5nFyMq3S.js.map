{"version":3,"file":"message-5nFyMq3S.js","names":[],"sources":["../../../../src/usercontent/message.js"],"sourcesContent":["import { checkOrigin } from \"../domain.js\";\r\n\r\nexport function setupEventHandlers() { \r\n    globalThis.addEventListener('message', handleMessage);\r\n}\r\n\r\nfunction reply(event, data) {\r\n    return event.source.postMessage(data, event.origin);\r\n}\r\n\r\n/**\r\n * @param {MessageEvent} event \r\n */\r\nexport async function handleMessage(event) {\r\n    const { data, origin } = event;\r\n    if (!await checkOrigin(origin)) return;\r\n    if (!data || typeof data !== 'object') return;\r\n\r\n    switch (data.type) {\r\n        case 'ping':\r\n            return reply(event, { type: 'pong' });\r\n            break;\r\n            \r\n        case 'render':\r\n            try {\r\n                document.documentElement.outerHTML = data.code;\r\n                return reply(event, {\r\n                    type: 'renderResult',\r\n                    success: true,\r\n                });\r\n            } catch (error) {\r\n                return reply(event, {\r\n                    type: 'renderResult',\r\n                    success: false,\r\n                    error: String(error),\r\n                    stack: String(error?.stack),\r\n                });\r\n            }\r\n            break;\r\n        \r\n        case 'evaluate':\r\n            try {\r\n                const config = data.config || {};\r\n                let result;\r\n                if (config.unwrap) {\r\n                    result = new Function('return eval(arguments[0])')(data.code);\r\n                }\r\n                else {\r\n                    let body;\r\n                    if (config.topLevelAwait) body = `return ((async function () { ${data.code} })());`;\r\n                    else if (config.simple) body = `return (() => ${data.code})();`;\r\n                    else body = data.code;\r\n                    result = await (new Function(body))();\r\n                }\r\n                return reply(event, {\r\n                    type: 'evaluateResult',\r\n                    success: true,\r\n                    result,\r\n                });\r\n            } catch (error) {\r\n                return reply(event, {\r\n                    type: 'evaluateResult',\r\n                    success: false,\r\n                    error: String(error),\r\n                    stack: String(error?.stack),\r\n                });\r\n            }\r\n            break;\r\n    \r\n        default:\r\n            break;\r\n    }\r\n}\r\n"],"mappings":";;AAEA,SAAgB,qBAAqB;AACjC,YAAW,iBAAiB,WAAW,cAAc;;AAGzD,SAAS,MAAM,GAAO,GAAM;AACxB,QAAO,EAAM,OAAO,YAAY,GAAM,EAAM,OAAO;;AAMvD,eAAsB,cAAc,GAAO;CACvC,IAAM,EAAE,SAAM,cAAW;AACpB,WAAM,YAAY,EAAO,IAC1B,GAAC,KAAQ,OAAO,KAAS,UAE7B,SAAQ,EAAK,MAAb;EACI,KAAK,OACD,QAAO,MAAM,GAAO,EAAE,MAAM,QAAQ,CAAC;EAGzC,KAAK;AACD,OAAI;AAEA,WADA,SAAS,gBAAgB,YAAY,EAAK,MACnC,MAAM,GAAO;KAChB,MAAM;KACN,SAAS;KACZ,CAAC;YACG,GAAO;AACZ,WAAO,MAAM,GAAO;KAChB,MAAM;KACN,SAAS;KACT,OAAO,OAAO,EAAM;KACpB,OAAO,OAAO,GAAO,MAAM;KAC9B,CAAC;;AAEN;EAEJ,KAAK;AACD,OAAI;IACA,IAAM,IAAS,EAAK,UAAU,EAAE,EAC5B;AACJ,QAAI,EAAO,OACP,KAAa,SAAS,4BAA4B,CAAC,EAAK,KAAK;SAE5D;KACD,IAAI;AAIJ,KAHA,AAEK,IAFD,EAAO,gBAAsB,gCAAgC,EAAK,KAAK,WAClE,EAAO,SAAe,iBAAiB,EAAK,KAAK,QAC9C,EAAK,MACjB,IAAS,MAAW,SAAS,EAAK,EAAG;;AAEzC,WAAO,MAAM,GAAO;KAChB,MAAM;KACN,SAAS;KACT;KACH,CAAC;YACG,GAAO;AACZ,WAAO,MAAM,GAAO;KAChB,MAAM;KACN,SAAS;KACT,OAAO,OAAO,EAAM;KACpB,OAAO,OAAO,GAAO,MAAM;KAC9B,CAAC;;AAEN;EAEJ,QACI"}