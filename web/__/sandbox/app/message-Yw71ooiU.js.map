{"version":3,"file":"message-Yw71ooiU.js","names":[],"sources":["../../../../src/management/message.js"],"sourcesContent":["import { checkOrigin } from \"../domain.js\";\r\n\r\nexport function setupEventHandlers() { \r\n    globalThis.addEventListener('message', handleMessage);\r\n}\r\n\r\nfunction reply(event, data) {\r\n    return event.source.postMessage(data, event.origin);\r\n}\r\n\r\n/**\r\n * @param {MessageEvent} event \r\n */\r\nexport async function handleMessage(event) {\r\n    const { data, origin } = event;\r\n    if (!await checkOrigin(origin, false)) return;\r\n    if (!data || typeof data !== 'object') return;\r\n\r\n    switch (data.type) {\r\n        case 'ping':\r\n            return reply(event, { type: 'pong' });\r\n            break;\r\n        \r\n        case 'isAvailable':\r\n            return reply(event, {\r\n                type: 'isAvailable',\r\n                result: await (async () => {\r\n                    try {\r\n                        const { serviceWorkerAvailable } = await import('../swAvailable.ts');\r\n                        return serviceWorkerAvailable();\r\n                    } catch { return false }\r\n                })()\r\n            });\r\n            break;\r\n        \r\n        case 'isWorkable':\r\n            return reply(event, {\r\n                type: 'isWorkable',\r\n                result: await (async () => {\r\n                    try {\r\n                        const { serviceWorkerWorking } = await import('../swAvailable.ts');\r\n                        return serviceWorkerWorking();\r\n                    } catch { return false }\r\n                })()\r\n            });\r\n            break;\r\n            \r\n        case 'register':\r\n            try {\r\n                await navigator.serviceWorker.register(\"/__service_worker__.js\", { scope: \"/\" });\r\n                return reply(event, {\r\n                    type: 'registerResult',\r\n                    success: true\r\n                });\r\n            } catch (error) {\r\n                return reply(event, {\r\n                    type: 'registerResult',\r\n                    success: false,\r\n                    reason: String(error),\r\n                    stack: String(error?.stack)\r\n                });\r\n            }\r\n    \r\n        default:\r\n            break;\r\n    }\r\n}\r\n"],"mappings":";;AAEA,SAAgB,qBAAqB;AACjC,YAAW,iBAAiB,WAAW,cAAc;;AAGzD,SAAS,MAAM,GAAO,GAAM;AACxB,QAAO,EAAM,OAAO,YAAY,GAAM,EAAM,OAAO;;AAMvD,eAAsB,cAAc,GAAO;CACvC,IAAM,EAAE,SAAM,cAAW;AACpB,WAAM,YAAY,GAAQ,GAAM,IACjC,GAAC,KAAQ,OAAO,KAAS,UAE7B,SAAQ,EAAK,MAAb;EACI,KAAK,OACD,QAAO,MAAM,GAAO,EAAE,MAAM,QAAQ,CAAC;EAGzC,KAAK,cACD,QAAO,MAAM,GAAO;GAChB,MAAM;GACN,QAAQ,OAAO,YAAY;AACvB,QAAI;KACA,IAAM,EAAE,8BAA2B,MAAM,OAAO;AAChD,YAAO,GAAwB;YAC3B;AAAE,YAAO;;OACjB;GACP,CAAC;EAGN,KAAK,aACD,QAAO,MAAM,GAAO;GAChB,MAAM;GACN,QAAQ,OAAO,YAAY;AACvB,QAAI;KACA,IAAM,EAAE,4BAAyB,MAAM,OAAO;AAC9C,YAAO,GAAsB;YACzB;AAAE,YAAO;;OACjB;GACP,CAAC;EAGN,KAAK,WACD,KAAI;AAEA,UADA,MAAM,UAAU,cAAc,SAAS,0BAA0B,EAAE,OAAO,KAAK,CAAC,EACzE,MAAM,GAAO;IAChB,MAAM;IACN,SAAS;IACZ,CAAC;WACG,GAAO;AACZ,UAAO,MAAM,GAAO;IAChB,MAAM;IACN,SAAS;IACT,QAAQ,OAAO,EAAM;IACrB,OAAO,OAAO,GAAO,MAAM;IAC9B,CAAC;;EAGV,QACI"}