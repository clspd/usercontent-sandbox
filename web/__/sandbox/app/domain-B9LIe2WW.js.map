{"version":3,"file":"domain-B9LIe2WW.js","names":[],"sources":["../../../../src/sha256.js","../../../../src/domain.js"],"sourcesContent":["export async function asha256(arrayBuffer) {\r\n    return Array.from(new Uint8Array(await crypto.subtle.digest('SHA-256', arrayBuffer))).map(b => b.toString(16).padStart(2, '0')).join('');\r\n}\r\nexport default async function sha256(input) {\r\n    return await asha256((new TextEncoder()).encode(input));\r\n}\r\nexport { sha256 };\r\nexport async function bsha256(blob) {\r\n    return await asha256(await blob.arrayBuffer());\r\n}","import { HOST_BASE, TRUSTED_ORIGINS } from '../web/config.json' with { type: 'json' };\r\nimport sha256 from './sha256.js';\r\nexport const hostname = window.location.hostname;\r\nexport const isCorrectHostname = hostname.endsWith(HOST_BASE);\r\nexport const prefix = isCorrectHostname ? hostname.slice(0, hostname.length - HOST_BASE.length) : '';\r\n\r\nconst publicSiteRegex = /^public(\\d+)\\.$/;\r\nconst specificSiteRegex = /^([a-z0-9]+?)-([a-f0-9]+?)\\.$/; // 1: random id 2: sha256(origin).substring(0, 32)\r\n\r\nexport const isPublicSite = publicSiteRegex.test(prefix);\r\nexport const publicSiteId = isPublicSite ? publicSiteRegex.exec(prefix)[1] : '';\r\n\r\nexport const isSpecificSite = specificSiteRegex.test(prefix);\r\nexport const [specificSiteId, specificSiteHash] = isSpecificSite ? specificSiteRegex.exec(prefix) : ['', ''];\r\n\r\nexport const cachedDomainName2Hash = new Map();\r\n\r\nexport async function getDomainHash(domainName) {\r\n    if (cachedDomainName2Hash.has(domainName)) {\r\n        return cachedDomainName2Hash.get(domainName);\r\n    }\r\n    const hash = (await sha256(domainName)).substring(0, 32);\r\n    cachedDomainName2Hash.set(domainName, hash);\r\n    return hash;\r\n}\r\n\r\nexport async function checkOrigin(origin, allowPublic = true) {\r\n    if (isPublicSite) return allowPublic;\r\n    if (TRUSTED_ORIGINS.includes(origin)) return true;\r\n    if (!isSpecificSite) return false;\r\n    const domainHash = await getDomainHash(origin);\r\n    return domainHash === specificSiteHash;\r\n}\r\n"],"mappings":";AAAA,eAAsB,QAAQ,GAAa;AACvC,QAAO,MAAM,KAAK,IAAI,WAAW,MAAM,OAAO,OAAO,OAAO,WAAW,EAAY,CAAC,CAAC,CAAC,KAAI,MAAK,EAAE,SAAS,GAAG,CAAC,SAAS,GAAG,IAAI,CAAC,CAAC,KAAK,GAAG;;AAE5I,eAA8B,OAAO,GAAO;AACxC,QAAO,MAAM,QAAS,IAAI,aAAa,CAAE,OAAO,EAAM,CAAC;;ACF3D,MAAa,WAAW,OAAO,SAAS,UAE3B,SADoB,SAAS,SAAS,UAAU,GACnB,SAAS,MAAM,GAAG,SAAS,SAAS,UAAU,OAAO,GAAG;AAElG,IAAM,kBAAkB,mBAClB,oBAAoB;AAE1B,MAAa,eAAe,gBAAgB,KAAK,OAAO;AAC5B,gBAAe,gBAAgB,KAAK,OAAO,CAAC;AAExE,MAAa,iBAAiB,kBAAkB,KAAK,OAAO,EAC/C,CAAC,gBAAgB,oBAAoB,iBAAiB,kBAAkB,KAAK,OAAO,GAAG,CAAC,IAAI,GAAG,EAE/F,wCAAwB,IAAI,KAAK;AAE9C,eAAsB,cAAc,GAAY;AAC5C,KAAI,sBAAsB,IAAI,EAAW,CACrC,QAAO,sBAAsB,IAAI,EAAW;CAEhD,IAAM,KAAQ,MAAM,OAAO,EAAW,EAAE,UAAU,GAAG,GAAG;AAExD,QADA,sBAAsB,IAAI,GAAY,EAAK,EACpC;;AAGX,eAAsB,YAAY,GAAQ,IAAc,IAAM;AAK1D,QAJI,eAAqB,IACrB,gBAAgB,SAAS,EAAO,GAAS,KACxC,iBACc,MAAM,cAAc,EAAO,KACxB,mBAFM"}